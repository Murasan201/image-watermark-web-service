# 要件定義書：画像ウォーターマークWebサービス

## 1. 背景・目的

- **背景**：ブロガー、Webデザイナー、コンテンツクリエイターが画像の不正コピー防止のために手動でウォーターマークを挿入する手間を省きたいというニーズがある。
- **背景**：ユーザーが複数のJPEG画像に一括でウォーターマークを挿入し、まとめてダウンロードできるWebサービスの需要が高まっている。
- **目的**：直感的なブラウザUIで設定を行い、自動でウォーターマーク加工・一括ダウンロードを実現する。

## 2. 対象範囲## 2. 対象範囲

- 対象ファイル：拡張子「.jpg」「.jpeg」のみ
- ユーザー情報：DBには保持せず、認証情報のみDBで管理
- 環境：Vercelへのデプロイ、Neon PostgreSQL（無料プラン）を認証に利用

## 3. 機能要件

### 3.1 画像アップロード

- ドラッグ＆ドロップ、およびファイルダイアログ対応
- 同時選択：複数ファイル
- 拡張子チェック（.jpg/.jpeg以外は拒否）

### 3.2 ウォーターマーク設定

ブラウザ上で以下パラメータを入力

```
・フォントの種類（商用利用可フォントを選択）
・フォントサイズ
・ウォーターマークテキスト
・挿入位置（上部/中央/下部）
・ウォーターマーク透明度
・影のオフセット（X, Y）
・影の有効・無効
・影の透明度
```

### 3.3 ウォーターマーク適用＆一括ダウンロード

- 「実行」ボタンで全画像を加工
- 加工後の画像をZIP化し、ユーザーへダウンロード提供

### 3.4 設定ファイルの保存・読み込み

- 加工パラメータをJSON形式でローカル保存
- 保存済みJSONをアップロードすると、UIに設定を復元

### 3.5 認証

- ログイン画面：ユーザー名・パスワード入力
- 新規登録不要（事前に配布された認証情報を使用）
- 認証結果はNeon PostgreSQLで確認

## 4. 非機能要件

- **パフォーマンス**：1回の実行で20枚程度、合計500MBまでを想定
- **可用性**：Vercelの無料プラン範囲で稼働
- **セキュリティ**：HTTPS必須、認証・パスワードはハッシュ化して保存
- **スケーラビリティ**：サーバーレス関数のコールドスタート時間を考慮

## 5. 技術要件

- **フロントエンド**：React/Vue.js等によるSPA
  - 画像加工：HTML5 CanvasまたはWebAssembly版ImageMagickライブラリ
  - ZIP生成：JSZipなどのライブラリ
- **バックエンド**：Vercel Serverless Functions
  - 認証API（Neon PostgreSQL）
  - 必要に応じてサーバーサイドでの画像加工・ZIP生成
- **DB**：Neon PostgreSQL（無料プラン）
- **デプロイ**：Vercel CLIによる自動デプロイ

> **注意事項：フォントファイルの事前取得**
>
> - 商用利用可能なフォントファイルを利用する場合、対象フォントのライセンス確認とファイル取得先（例：Google Fontsや有償フォント提供元）を事前にプロジェクトチームへ提供し、配置方法を要望仕様として明示してください。

## 6. 技術的検討・懸念事項. 技術的検討・懸念事項

- **ブラウザ処理限界**：大量または高解像度画像をCanvasで扱うとメモリ不足や動作遅延の可能性あり。サーバーサイド処理が必要になる場合がある。
- **ZIP生成の負荷**：JSZipでの大量ファイル圧縮はCPU負荷・メモリ消費が大きく、タイムアウトリスクあり。バックエンド処理への切り替え検討。
- **Neon PostgreSQL接続制限**：無料プランでは同時接続数やクエリ数に制限があるため、認証APIのキャッシュやプール導入が必要。
- **File System Access API対応状況**：ローカルファイル保存・読み込み機能はブラウザ依存。対応ブラウザの限定やフォールバック機能の実装が必要。
- **フォントライセンス管理**：商用利用フォントをCDN配布する場合、ライセンス遵守と配布方法に注意。

## 7. 運用・保守

- **ログ管理**：エラーログのみVercelログ機能を利用。個人情報は収集しない。
- **障害対応**：Vercelのステータス監視、DB接続異常のアラート設定
- **バージョン管理**：GitHub連携、自動デプロイ

## 8. UI/UX要件

- レスポンシブ対応（PC/Mobile）
- アップロード進捗表示
- エラー／完了メッセージの明確化
- アクセシビリティ（キーボード操作、ARIA属性）

---

*以上の要件をもとに実装担当者は詳細設計へ進んでください。*

## 9. GitHub Repository

- **Repository Name**: `image-watermark-web-service`

